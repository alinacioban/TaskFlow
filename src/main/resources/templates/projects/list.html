<!doctype html>
<html lang="ro" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout :: base('Proiecte · TaskFlow', 'projects', ~{this :: content})}">
  <th:block th:fragment="content">

    <div class="d-flex align-items-center justify-content-between mb-3">

      <div class="d-flex align-items-center gap-2">
        <h1 class="h5 mb-0 text-primary fw-bold">Proiecte</h1>
        <span class="badge bg-secondary" th:text="${#lists.size(projects)} + ' în total'">0 în total</span>
      </div>

      <a class="btn btn-primary" th:href="@{/projects/new}">
        <i class="bi bi-plus-lg me-1"></i> Proiect Nou
      </a>
    </div>

    <!-- SEARCH BAR -->
    <form class="row g-2 mb-3" th:action="@{/projects}" method="get">
      <div class="col-sm-8 col-md-6">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input class="form-control" name="q" placeholder="Caută după nume…" th:value="${query}">
          <button class="btn btn-outline-secondary">Caută</button>
          <a class="btn btn-outline-light border" th:href="@{/projects}">Resetează</a>
        </div>
      </div>
    </form>

    <!-- TABLE -->
    <div class="card shadow-sm">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Proiect</th>
              <th>Descriere</th>
              <th>Creat la</th>
              <th class="text-end">Acțiuni</th>
            </tr>
          </thead>

          <tbody>
            <tr th:each="p : ${projects}">
              <td class="fw-semibold">
                <a th:href="@{|/projects/${p.id}|}" th:text="${p.name}">Nume</a>
              </td>

              <td class="text-truncate" style="max-width:480px" th:text="${p.description}">Descriere</td>

              <td th:text="${#temporals.format(p.createdAt,'dd.MM.yyyy')}">—</td>

              <td class="text-end">
                <div class="btn-group">

                  <!-- KANBAN -->
                  <a class="btn btn-sm btn-outline-primary" th:href="@{|/projects/${p.id}/board|}">
                    <i class="bi bi-kanban"></i>
                  </a>

                  <!-- EDIT -->
                  <a class="btn btn-sm btn-outline-secondary" th:href="@{|/projects/${p.id}/edit|}">
                    <i class="bi bi-pencil-square"></i>
                  </a>

                  <!-- DELETE -->
                  <button class="btn btn-sm btn-outline-danger"
                          data-bs-toggle="modal"
                          th:attr="data-bs-target=${'#del-'+p.id}">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>

                <!-- DELETE MODAL -->
                <div class="modal fade" th:id="${'del-'+p.id}" tabindex="-1">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">

                      <div class="modal-header">
                        <h5 class="modal-title">Ștergere Proiect</h5>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                      </div>

                      <div class="modal-body">
                        Sigur dorești să ștergi proiectul <b th:text="${p.name}">___</b>?
                      </div>

                      <div class="modal-footer">
                        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Renunță</button>
                        <form th:action="@{|/projects/${p.id}/delete|}" method="post">
                          <button class="btn btn-danger">
                            <i class="bi bi-trash me-1"></i>Șterge
                          </button>
                        </form>
                      </div>

                    </div>
                  </div>
                </div>

              </td>
            </tr>

            <!-- EMPTY -->
            <tr th:if="${#lists.isEmpty(projects)}">
              <td colspan="4" class="text-center text-muted py-5">
                <i class="bi bi-inbox display-6 d-block mb-2"></i>
                Nu există proiecte. Creează unul nou pentru a începe.
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>

  </th:block>
</th:block>
</html>